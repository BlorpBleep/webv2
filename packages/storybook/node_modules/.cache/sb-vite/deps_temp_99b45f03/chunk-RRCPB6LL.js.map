{
  "version": 3,
  "sources": ["../../../../../../node_modules/.pnpm/@react-aria+form@3.0.5_react@18.3.1/node_modules/@react-aria/form/dist/packages/@react-aria/form/src/useFormValidation.ts"],
  "sourcesContent": ["/*\n * Copyright 2023 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {FormValidationState} from '@react-stately/form';\nimport {RefObject, useEffect} from 'react';\nimport {setInteractionModality} from '@react-aria/interactions';\nimport {useEffectEvent, useLayoutEffect} from '@react-aria/utils';\nimport {Validation, ValidationResult} from '@react-types/shared';\n\ntype ValidatableElement = HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n\ninterface FormValidationProps<T> extends Validation<T> {\n  focus?: () => void\n}\n\nexport function useFormValidation<T>(props: FormValidationProps<T>, state: FormValidationState, ref: RefObject<ValidatableElement> | undefined) {\n  let {validationBehavior, focus} = props;\n\n  // This is a useLayoutEffect so that it runs before the useEffect in useFormValidationState, which commits the validation change.\n  useLayoutEffect(() => {\n    if (validationBehavior === 'native' && ref?.current) {\n      let errorMessage = state.realtimeValidation.isInvalid ? state.realtimeValidation.validationErrors.join(' ') || 'Invalid value.' : '';\n      ref.current.setCustomValidity(errorMessage);\n\n      // Prevent default tooltip for validation message.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=605277\n      if (!ref.current.hasAttribute('title')) {\n        ref.current.title = '';\n      }\n\n      if (!state.realtimeValidation.isInvalid) {\n        state.updateValidation(getNativeValidity(ref.current));\n      }\n    }\n  });\n\n  let onReset = useEffectEvent(() => {\n    state.resetValidation();\n  });\n\n  let onInvalid = useEffectEvent((e: Event) => {\n    // Only commit validation if we are not already displaying one.\n    // This avoids clearing server errors that the user didn't actually fix.\n    if (!state.displayValidation.isInvalid) {\n      state.commitValidation();\n    }\n\n    // Auto focus the first invalid input in a form, unless the error already had its default prevented.\n    let form = ref?.current?.form;\n    if (!e.defaultPrevented && ref && form && getFirstInvalidInput(form) === ref.current) {\n      if (focus) {\n        focus();\n      } else {\n        ref.current?.focus();\n      }\n\n      // Always show focus ring.\n      setInteractionModality('keyboard');\n    }\n\n    // Prevent default browser error UI from appearing.\n    e.preventDefault();\n  });\n\n  let onChange = useEffectEvent(() => {\n    state.commitValidation();\n  });\n\n  useEffect(() => {\n    let input = ref?.current;\n    if (!input) {\n      return;\n    }\n\n    let form = input.form;\n    input.addEventListener('invalid', onInvalid);\n    input.addEventListener('change', onChange);\n    form?.addEventListener('reset', onReset);\n    return () => {\n      input!.removeEventListener('invalid', onInvalid);\n      input!.removeEventListener('change', onChange);\n      form?.removeEventListener('reset', onReset);\n    };\n  }, [ref, onInvalid, onChange, onReset, validationBehavior]);\n}\n\nfunction getValidity(input: ValidatableElement) {\n  // The native ValidityState object is live, meaning each property is a getter that returns the current state.\n  // We need to create a snapshot of the validity state at the time this function is called to avoid unpredictable React renders.\n  let validity = input.validity;\n  return {\n    badInput: validity.badInput,\n    customError: validity.customError,\n    patternMismatch: validity.patternMismatch,\n    rangeOverflow: validity.rangeOverflow,\n    rangeUnderflow: validity.rangeUnderflow,\n    stepMismatch: validity.stepMismatch,\n    tooLong: validity.tooLong,\n    tooShort: validity.tooShort,\n    typeMismatch: validity.typeMismatch,\n    valueMissing: validity.valueMissing,\n    valid: validity.valid\n  };\n}\n\nfunction getNativeValidity(input: ValidatableElement): ValidationResult {\n  return {\n    isInvalid: !input.validity.valid,\n    validationDetails: getValidity(input),\n    validationErrors: input.validationMessage ? [input.validationMessage] : []\n  };\n}\n\nfunction getFirstInvalidInput(form: HTMLFormElement): ValidatableElement | null {\n  for (let i = 0; i < form.elements.length; i++) {\n    let element = form.elements[i] as ValidatableElement;\n    if (!element.validity.valid) {\n      return element;\n    }\n  }\n\n  return null;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAwBO,SAAS,0CAAqB,OAA+B,OAA4B,KAA8C;AAC5I,MAAI,EAAA,oBAAmB,MAAO,IAAI;AAGlC,GAAA,GAAA,2CAAgB,MAAA;AACd,QAAI,uBAAuB,aAAY,QAAA,QAAA,QAAA,SAAA,SAAA,IAAK,UAAS;AACnD,UAAI,eAAe,MAAM,mBAAmB,YAAY,MAAM,mBAAmB,iBAAiB,KAAK,GAAA,KAAQ,mBAAmB;AAClI,UAAI,QAAQ,kBAAkB,YAAA;AAI9B,UAAI,CAAC,IAAI,QAAQ,aAAa,OAAA;AAC5B,YAAI,QAAQ,QAAQ;AAGtB,UAAI,CAAC,MAAM,mBAAmB;AAC5B,cAAM,iBAAiB,wCAAkB,IAAI,OAAO,CAAA;IAExD;EACF,CAAA;AAEA,MAAI,WAAU,GAAA,2CAAe,MAAA;AAC3B,UAAM,gBAAe;EACvB,CAAA;AAEA,MAAI,aAAY,GAAA,2CAAe,CAAC,MAAA;QAQnB;AALX,QAAI,CAAC,MAAM,kBAAkB;AAC3B,YAAM,iBAAgB;AAIxB,QAAI,OAAO,QAAA,QAAA,QAAA,SAAA,UAAA,eAAA,IAAK,aAAO,QAAZ,iBAAA,SAAA,SAAA,aAAc;AACzB,QAAI,CAAC,EAAE,oBAAoB,OAAO,QAAQ,2CAAqB,IAAA,MAAU,IAAI,SAAS;UAIlF;AAHF,UAAI;AACF,cAAA;;SAEA,gBAAA,IAAI,aAAO,QAAX,kBAAA,SAAA,SAAA,cAAa,MAAK;AAIpB,OAAA,GAAA,2CAAuB,UAAA;IACzB;AAGA,MAAE,eAAc;EAClB,CAAA;AAEA,MAAI,YAAW,GAAA,2CAAe,MAAA;AAC5B,UAAM,iBAAgB;EACxB,CAAA;AAEA,GAAA,GAAA,aAAAA,WAAU,MAAA;AACR,QAAI,QAAQ,QAAA,QAAA,QAAA,SAAA,SAAA,IAAK;AACjB,QAAI,CAAC;AACH;AAGF,QAAI,OAAO,MAAM;AACjB,UAAM,iBAAiB,WAAW,SAAA;AAClC,UAAM,iBAAiB,UAAU,QAAA;AACjC,aAAA,QAAA,SAAA,SAAA,SAAA,KAAM,iBAAiB,SAAS,OAAA;AAChC,WAAO,MAAA;AACL,YAAO,oBAAoB,WAAW,SAAA;AACtC,YAAO,oBAAoB,UAAU,QAAA;AACrC,eAAA,QAAA,SAAA,SAAA,SAAA,KAAM,oBAAoB,SAAS,OAAA;IACrC;EACF,GAAG;IAAC;IAAK;IAAW;IAAU;IAAS;GAAmB;AAC5D;AAEA,SAAS,kCAAY,OAAyB;AAG5C,MAAI,WAAW,MAAM;AACrB,SAAO;IACL,UAAU,SAAS;IACnB,aAAa,SAAS;IACtB,iBAAiB,SAAS;IAC1B,eAAe,SAAS;IACxB,gBAAgB,SAAS;IACzB,cAAc,SAAS;IACvB,SAAS,SAAS;IAClB,UAAU,SAAS;IACnB,cAAc,SAAS;IACvB,cAAc,SAAS;IACvB,OAAO,SAAS;EAClB;AACF;AAEA,SAAS,wCAAkB,OAAyB;AAClD,SAAO;IACL,WAAW,CAAC,MAAM,SAAS;IAC3B,mBAAmB,kCAAY,KAAA;IAC/B,kBAAkB,MAAM,oBAAoB;MAAC,MAAM;QAAqB,CAAA;EAC1E;AACF;AAEA,SAAS,2CAAqB,MAAqB;AACjD,WAAS,IAAI,GAAG,IAAI,KAAK,SAAS,QAAQ,KAAK;AAC7C,QAAI,UAAU,KAAK,SAAS,CAAA;AAC5B,QAAI,CAAC,QAAQ,SAAS;AACpB,aAAO;EAEX;AAEA,SAAO;AACT;",
  "names": ["$9Gacy$useEffect"]
}
